var m=new lang,g_storage=new myStorage,server_url="http://oauth.asus.com/aicloud/",g_bLoginFacebook=!1,g_bLoginGoogle=!1,g_key_file=null,g_crt_file=null,g_intermediate_crt_file=null,g_create_account_dialog=null,g_account_info_dialog=null,g_invite_token="";
$("document").ready(function(){var e=getUrlVars(),c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan");m.setLanguage(c);var c=e.s==void 0?0:e.s,b=e.p==void 0?0:e.p;$("ul.tabs li").eq(b).addClass("active");$(".tab_content").hide().eq(b).show();c&&$("ul.tabs li").each(function(a){a!=b&&$("ul.tabs li").eq(a).hide()});$("ul.tabs li").click(function(){var a=$(this),b=a.find("a").attr("href");a.addClass("active").siblings(".active").removeClass("active");
$(b).stop(!1,!0).fadeIn().siblings().hide();return!1}).find("a").focus(function(){this.blur()});$("button#btn_rescan").click(function(){$("button#btn_rescan").attr("disabled",!0);$("button#btn_rescan").text("Wait");parent.doRescanSamba()});$("button#btn_gen_crt").click(function(){var a=new davlib.DavClient;a.initialize();var b=window.location.hostname,c=m.getString("msg_gen_crt_confirm"),c=c.replace("%s",b);confirm(c)&&($("#crt_creating").show(),a.GENROOTCERTIFICATE("/",2048,"AiCloud","","TW","Taiwan",
"Hsinchu","ASUS","RD",b,function(b){b==200&&($("#crt_creating").hide(),alert(m.getString("msg_gen_crt_complete")),a.APPLYAPP("/","apply","","restart_webdav",function(b){b==200&&setTimeout(function(){parent.location.reload(!1)},6E3);a=null}))}))});$("button#btn_import_crt").click(function(){$("#import_crt").show();$("#import_crt").css("left",tempX);tempY+$("#filelink").height()>$("body").height()?$("#import_crt").css("top",$("body").height()-$("#filelink").height()):$("#import_crt").css("top",tempY)});
$("button#btn_export_crt").click(function(){window.open("/aicloud.crt")});$("button#btn_create_account").click(function(){g_create_account_dialog.data("action","new").dialog("open")});$("button#btn_create_invite").click(function(){g_create_account_dialog.data("action","invite").dialog("open")});$("li#rescan a").text(m.getString("title_rescan"));$("li#sharelink a").text(m.getString("title_sharelink"));$("li#version a").text(m.getString("title_version"));$("li#settings a").text(m.getString("title_crt"));
$("li#account a").text(m.getString("title_account"));$("button#ok").text(m.getString("btn_ok"));$("button#cancel").text(m.getString("btn_close"));$("#btn_rescan").text(m.getString("btn_rescan"));$("span#desc_rescan").text(m.getString("title_desc_rescan"));$("span#aicloud_desc_version").text("AiCloud "+m.getString("title_version"));$("span#aicloud_version").text(g_storage.get("aicloud_version"));$("span#smartsync_desc_version").text("SmartSync "+m.getString("title_version"));$("span#smartsync_version").text(g_storage.get("smartsync_version"));
$("span#desc_version").text("FW "+m.getString("title_version"));$("span#version").text(g_storage.get("router_version"));$("p.desc_share_link").text(m.getString("title_copy_string"));$("#label_gen_crt").text(m.getString("title_gen_crt"));$("#btn_gen_crt").text(m.getString("title_gen_crt"));$("#btn_import_crt").text(m.getString("title_import_crt"));$("#desc_gen_crt").text(m.getString("title_desc_gen_crt"));$("#label_server_crt").text(m.getString("title_server_crt"));$("#label_crt_type").text(m.getString("title_crt_type"));
$("#label_self_crt_type").text(m.getString("title_self_crt_type"));$("#label_crt_to").text(m.getString("title_crt_to"));$("#label_crt_from").text(m.getString("title_crt_from"));$("#label_crt_end_date").text(m.getString("title_crt_end_date"));$("#btn_export_crt").text(m.getString("title_export_crt"));$("#label_https_crt_cn").text(m.getString("https_crt_cn"));$("#crt_creating").text(m.getString("msg_gen_crt_creating"));$("#desc_import_crt").text(m.getString("desc_import_crt"));$("#label_select_private_key").text(m.getString("title_select_private_key"));
$("#label_select_certificate").text(m.getString("title_select_certificate"));$("#label_select_intermediate_certificate").text(m.getString("title_select_intermediate_certificate"));$("#import").text(m.getString("title_import_crt"));$("#label_create_account").text(m.getString("title_create_account"));$("#desc_create_account").text(m.getString("title_desc_create_account"));$("#btn_create_account").text(m.getString("title_create_account"));$("#btn_create_invite").text(m.getString("title_invite_account"));
$("#label_username").text(m.getString("title_username"));$("#label_password").text(m.getString("title_password"));$("#label_password_confirm").text(m.getString("title_password_confirm"));$("#label_size_limit").text(m.getString("title_size_limit"));$("#label_access_permission").text(m.getString("title_access_permission"));$("#label_account_list").text(m.getString("title_account_list"));$("#table_account_list td[field=username]").text(m.getString("title_username"));$("#table_account_list td[field=type]").text(m.getString("title_type"));
$("#table_account_list td[field=edit]").text(m.getString("title_edit"));$("#table_account_list td[field=delete]").text(m.getString("title_delete"));$("#label_account_invite_list").text(m.getString("title_account_invite_list"));$("#table_account_invite_list td[field=invite]").text(m.getString("title_invite"));$("#table_account_invite_list td[field=createtime]").text(m.getString("title_create_time"));$("#table_account_invite_list td[field=edit]").text(m.getString("title_edit"));$("#table_account_invite_list td[field=delete]").text(m.getString("title_delete"));
$("#label_security_code").text(m.getString("title_security_code"));$("#select_security_code option[value=0]").text(m.getString("title_security_code_type_none"));$("#select_security_code option[value=1]").text(m.getString("title_security_code_type_manually"));$("#select_security_code option[value=2]").text(m.getString("title_security_code_type_auto"));$("#label_smart_access").text(m.getString("title_smart_access"));$("#span_smart_access").text(m.getString("title_enable"));b==1?refreshShareLinkList():
b==3&&refreshCertificateInfo();$(".abgne_tab").css("height",$(window).height()-80);$("#facebook .user_login_option").click(function(){g_bLoginFacebook||facebook_login()});$("#google .user_login_option").click(function(){g_bLoginGoogle||google_login()});$("#btn_select_key").change(function(a){a.target.files.length!=1?alert("Please select a key file!"):g_key_file=a.target.files[0]});$("#btn_select_crt").change(function(a){a.target.files.length!=1?alert("Please select a key file!"):g_crt_file=a.target.files[0]});
$("#btn_select_intermediate_crt").change(function(a){a.target.files.length==1&&(g_intermediate_crt_file=a.target.files[0])});$("#select_security_code").change(function(){$(this).val()==1?$("#input_security_code").show():$("#input_security_code").hide()});g_create_account_dialog=$("#dialog_create_account").dialog({autoOpen:!1,height:500,width:600,modal:!0,buttons:{OK:function(){var a=myencodeURI(String($("#input_username").val()).trim()),b=String($("#input_password").val()).trim(),c=String($("#input_password_confirm").val()).trim(),
e="aicloud",f=$(this).data("action"),d=-1;if(f!="invite"&&f!="modify_invite"){if(a==""){alert(m.getString("msg_err_account_blank"));return}if(b!=c){alert(m.getString("msg_err_password_matched"));return}}c=new davlib.DavClient;c.initialize();f=="modify"&&(d=parseInt($(this).data("id")));var k="",h;for(h in g_folder_permission_info)if(g_folder_permission_info.hasOwnProperty(h))for(var l in g_folder_permission_info[h])if(g_folder_permission_info[h].hasOwnProperty(l)){var o=g_folder_permission_info[h][l];
k+=myencodeURI(h)+","+myencodeURI(l)+","+o;k+=";"}a=encodeURIComponent(a);b=encodeURIComponent(b);e=encodeURIComponent(e);k=encodeURIComponent(k);if(f=="invite"||f=="modify_invite"){var i="";if($("#select_security_code").val()==0)i="";else if($("#select_security_code").val()==1){if(i=$("#input_security_code").val(),i==""){alert("Please input security code!");return}}else $("#select_security_code").val()==2&&(i=Math.floor(1E3+Math.random()*9E3));var p=$("#input_smart_access").prop("checked")==!0?1:
0;c.UPDATEACCOUNTINVITE("/",g_invite_token,k,p,i,function(a,b,d){a==200?(a=parseXml(d),a=$(a).find("token").text(),g_create_account_dialog.dialog("close"),query_account_invite_list(),f=="invite"&&g_account_info_dialog.data("action","invite").data("invite_token",a).data("enable_smart_access",p).data("security_code",i).dialog("open")):alert(m.getString("msg_err_account_create"))},null)}else c.UPDATEACCOUNT("/",d,a,b,e,k,function(a,b,d){a==200?d=="ACCOUNT_IS_EXISTED"?alert(m.getString("msg_err_account_existed")):
(set_account_input_default_val(),g_create_account_dialog.dialog("close"),query_account_list()):alert(m.getString("msg_err_account_create"))},null)},CANCEL:function(){g_create_account_dialog.dialog("close")}},close:function(){},open:function(){$("#dialog_create_account .ui-button-text:contains(OK)").text(m.getString("btn_ok"));$("#dialog_create_account .ui-button-text:contains(CANCEL)").text(m.getString("btn_cancel"));var a=$(this).data("action");if(a=="modify"){parseInt($(this).data("id"));a=$(this).data("username");
$(this).data("usertype");$("#dialog_create_account").dialog("option","title",m.getString("title_update_account"));$("#input_username").attr("disabled",!0);var b=new davlib.DavClient;b.initialize();b.GETACCOUNTINFO("/",a,function(a,b,d){a==200&&(a=parseXml(d),d=$(a),a=d.find("username").text(),b=d.find("type").text(),d.find("permission").text(),d=d.find("password").text(),$(".option_account").show(),$(".option_invite").hide(),$("#input_username").val(a),$("#input_password").val(d),$("#input_password_confirm").val(d),
$("#table_share_folder").css("height",220),query_partition_share_folder(b,a,g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0))},null)}else if(a=="new")$("#dialog_create_account").dialog("option","title",m.getString("title_create_account")),$(".option_account").show(),$(".option_invite").hide(),$("#input_username").attr("disabled",!1),$("#input_username").val(""),$("#input_password").val(""),$("#input_password_confirm").val(""),$("#input_name").val(""),$("#table_share_folder").css("height",
220),query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0);else if(a=="invite")$("#dialog_create_account").dialog("option","title",m.getString("title_invite_account")),$(".option_account").hide(),$(".option_invite").show(),$("#table_share_folder").css("height",280),g_invite_token="",query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0);else if(a=="modify_invite"){var c=$(this).data("token"),
b=new davlib.DavClient;b.initialize();b.GETACCOUNTINVITEINFO("/",c,function(a,b,d){a==200&&(a=parseXml(d),b=$(a),b.find("permission").text(),a=parseInt(b.find("smart_access").text()),b=b.find("security_code").text(),g_invite_token=c,$(".option_account").hide(),$(".option_invite").show(),$("#table_share_folder").css("height",280),$("#input_smart_access").prop("checked",a==1?!0:!1),b==""?($("#select_security_code").val(0),$("#input_security_code").hide()):($("#select_security_code").val(1),$("#input_security_code").show(),
$("#input_security_code").val(b)),query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0))},null)}}});g_account_info_dialog=$("#dialog_account_info").dialog({autoOpen:!1,height:500,width:600,modal:!0,buttons:{OK:function(){g_account_info_dialog.dialog("close")}},open:function(){var a=$(this).data("action"),b=$(this).data("invite_token"),c=$(this).data("enable_smart_access"),e=$(this).data("security_code");if(a=="invite"){a="";g_storage.get("ddns_host_name")==
""?(a=window.location.href.indexOf("/",window.location.protocol.length+2),a=window.location.href.slice(0,a)+"/"+b):(a="https://"+g_storage.get("ddns_host_name"),g_storage.get("https_port")!="443"&&(a+=":"+g_storage.get("https_port")),a+="/"+b);var b=m.getString("msg_invitation_desc1"),c=m.getString("title_smart_access")+": "+(c==1?m.getString("title_enable"):m.getString("title_disable")),e=m.getString("title_security_code")+": "+(e==""||e=="none"?m.getString("title_security_code_type_none"):e),f=
b.replace(/\n/g,"<br><br>");f+='<a style="color:#ff0000" href="'+a+'" target="_blank">'+a+"</a>";f+="<br><br>"+c;f+="<br><br>"+e;$("#account_info").html(f);f="mailto:?subject=Welcome to my AiCloud";f+="&body=";f+=encodeURIComponent(b);f+=encodeURIComponent(a);f+=encodeURIComponent("\n"+c);f+=encodeURIComponent("\n"+e);$("#mail_invitation").attr("href",f)}}});query_account_list();query_account_invite_list()});var g_folder_permission_info=[];
function query_partition_share_folder(e,c,b,a,j,g){if(!(g>1)){var n={action:"query_disk_folder",id:"#"};n.path=b;n.type=e;n.account=c;$.ajax({url:"/query_field.json",data:n,type:"GET",dataType:"json",timeout:2E4,error:function(){alert("Error loading json data!")},success:function(f){var d="<table class='tree_table'>";g+=1;for(var k=0;k<f.length;k++){var h=f[k].text,l=parseInt(f[k].permission),o=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),i=o+"_"+k;g==1?(d+="<tr class='partion_table_tr' style='background-color:#989898;color:#ffffff'>",
d+="<td>",d+=h,d+="</td>",d+="<td></td>",d+="</tr>",g_folder_permission_info[h]=[]):g==2&&(d+="<tr class='folder_table_tr' style='border-bottom:1px solid #989898'>",d+="<td style='padding-left:10px'>",d+=h,d+="</td>",d+="<td style='width:150px;'>",d+="<div id='f"+i+"' data-id='"+i+"' class='FileStatus' data-partition='"+a+"' data-folder='"+h+"'>",d+="<table>",d+="<tr data-permission='"+l+"'>",d+="<td><input type='radio' class='radio_permission' name='g"+i+"' id='g"+i+"' value='3'"+(l==3?" checked":
"")+">R/W</td>",d+="<td><input type='radio' class='radio_permission' name='g"+i+"' id='g"+i+"' value='1'"+(l==1?" checked":"")+">R</td>",d+="<td><input type='radio' class='radio_permission' name='g"+i+"' id='g"+i+"' value='0'"+(l==0||l==-1?" checked":"")+">N</td>",d+="</tr>",d+="</table>",d+="</div>",d+="</td>",d+="</tr>",g_folder_permission_info[a][h]=l);l="table_"+o;d+="<tr><td colspan='2'><div id='"+l+"'></div></td></tr>";query_partition_share_folder(e,c,b+"/"+h,h,l,g)}d+="</table>";$("#"+j).html(d);
$(".folder_table_tr").mouseenter(function(){$(this).css("background-color","#cccccc")});$(".folder_table_tr").mouseleave(function(){$(this).css("background-color","transparent")});$(".radio_permission").change(function(){$(this).closest(".FileStatus").attr("data-id");var a=$(this).closest(".FileStatus").attr("data-partition"),b=$(this).closest(".FileStatus").attr("data-folder"),d=parseInt($(this).val());g_folder_permission_info[a][b]=d})}})}}
function set_account_input_default_val(){$("#input_username").val("");$("#input_password").val("");$("#input_password_confirm").val("");$("#input_name").val("")}
function query_account_list(){var e=new davlib.DavClient;e.initialize();e.GETACCOUNTLIST("/",function(c,b,a){if(c==200){c=parseXml(a);c=$(c).find("account");b="";for(a=0;a<c.length;a++){var e=parseXml(c[a]),g=$(e),e=g.find("id").text(),n=g.find("username").text(),g=g.find("type").text();b+="<tr data-acid='"+e+"' data-username='"+n+"' data-usertype='"+g+"'>";b+="<td>";b+=n;b+="</td>";b+="<td>";b+=g;b+="</td>";b+="<td align='center'>";g=="aicloud"&&(b+="<input class='edit_account' type='button' value='"+
m.getString("title_edit")+"'/>");b+="</td>";b+="<td align='center'>";g=="aicloud"&&(b+="<input class='delete_account' type='button' value='"+m.getString("title_delete")+"'/>");b+="</td>";b+="</tr>"}$("#table_account_list tbody").empty();$("#table_account_list tbody").append(b);$(".edit_account").click(function(){var a=$(this).closest("tr"),b=a.attr("data-acid"),c=a.attr("data-username"),a=a.attr("data-usertype");g_create_account_dialog.data("action","modify").data("id",b).data("username",c).data("usertype",
a).dialog("open")});$(".delete_account").click(function(){var a=$(this).closest("tr");a.attr("data-acid");var a=a.attr("data-username"),b=m.getString("msg_delete_account"),b=b.replace("%s",a);confirm(b)&&(b=new davlib.DavClient,b.initialize(),b.DELETEACCOUNT("/",a,function(a){a==200?query_account_list():alert("Fail to delete account.")},null))})}},null)}
function query_account_invite_list(){var e=window.location.href.indexOf("/",window.location.protocol.length+2);window.location.href.slice(0,e);g_storage.get("ddns_host_name")==""?(e=window.location.href.indexOf("/",window.location.protocol.length+2),window.location.href.slice(0,e)):g_storage.get("ddns_host_name");e=new davlib.DavClient;e.initialize();e.GETACCOUNTINVITELIST("/",function(c,b,a){if(c==200){c=parseXml(a);c=$(c).find("invite");b="";for(a=0;a<c.length;a++){var e=parseXml(c[a]),g=$(e),e=
g.find("id").text(),n=g.find("token").text(),f=g.find("timestamp").text(),d=g.find("smart_access").text(),g=g.find("security_code").text();b+="<tr data-aciid='"+e+"' data-token='"+n+"' data-smart-access='"+d+"' data-security-code='"+g+"'>";b+="<td>";b+="<a href='#' class='show_account_invite_info'>";b+=n;b+="</a>";b+="</td>";b+="<td>";b+=f;b+="</td>";b+="<td align='center'>";b+="<input class='edit_account_invite' type='button' value='"+m.getString("title_edit")+"'/>";b+="</td>";b+="<td align='center'>";
b+="<input class='delete_account_invite' type='button' value='"+m.getString("title_delete")+"'/>";b+="</td>";b+="</tr>"}$("#table_account_invite_list tbody").empty();$("#table_account_invite_list tbody").append(b);$(".edit_account_invite").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");a=a.attr("data-token");g_create_account_dialog.data("action","modify_invite").data("token",a).dialog("open")});$(".delete_account_invite").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");
var a=a.attr("data-token"),b=m.getString("msg_delete_account_invite");confirm(b)&&(b=new davlib.DavClient,b.initialize(),b.DELETEACCOUNTINVITE("/",a,function(a){a==200?query_account_invite_list():alert("Fail to delete account invite.")},null))});$(".show_account_invite_info").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");var b=a.attr("data-token"),c=a.attr("data-smart-access"),a=a.attr("data-security-code");g_account_info_dialog.data("action","invite").data("invite_token",b).data("enable_smart_access",
c).data("security_code",a).dialog("open")})}},null)}function onFacebookLogin(e,c){alert(e+", "+c)}
function facebook_login(){window._onFacebookLogin=this.onFacebookLogin;var e=window.location.href.indexOf("/",window.location.protocol.length+2),c=server_url+"fb_authorize.html?callback=_onFacebookLogin&ps5host=",e=window.location.href.slice(0,e)+"/smb/css/service/callback.html&response_type=token",c="http://www.facebook.com/dialog/oauth/?scope=publish_stream%2Cuser_photos%2Coffline_access&client_id=697618710295679&display=popup&redirect_uri="+encodeURIComponent(c)+e;window.open(c,"mywindow","menubar=1,resizable=0,width=630,height=250, top=100, left=300")}
function onGoogleLogin(e,c){alert(e+", "+c)}
function google_login(){var e=window.location.href.indexOf("/",window.location.protocol.length+2),c=server_url+"google_authorize.html",e=window.location.href.slice(0,e)+"/smb/css/service/callback.html",c="https://accounts.google.com/o/oauth2/auth?response_type=token&redirect_uri="+encodeURIComponent(c)+"&client_id=103584452676-oo7gkbh8dg7nm07lao9a0i3r9jh6jfra.apps.googleusercontent.com&scope=https://www.googleapis.com%2Fauth%2Fuserinfo.email+https://www.googleapis.com%2Fauth%2Fuserinfo.profile+https://picasaweb.google.com%2Fdata&state=/callback=onGoogleLogin+ps5host="+e;
window.open(c,"mywindow","menubar=1,resizable=0,width=630,height=250, top=100, left=300")}
function getLatestVersion(){var e=new davlib.DavClient;e.initialize();$("#update").text(m.getString("msg_check_latest_ver"));e.GETLATESTVER("/",function(c,b,a){c==200?(c=parseXml(a),c=$(c).find("version").text().split("_")[1],b=g_storage.get("router_version").split(".")[3],c>b?$("#update").text(m.getString("msg_update_latest_ver")):$("#update").text(m.getString("msg_latest_ver"))):$("#update").text(m.getString("msg_check_latest_ver_error"));e=null})}
function refreshShareLinkList(){var e=g_storage.get("webdav_mode"),c=g_storage.get("ddns_host_name"),b=window.location.host,a="",a=isPrivateIP(b)?c==""?b:c:b;a.indexOf(":")!=-1&&(a=a.substring(0,a.indexOf(":")));e==0?a="http://"+a+":"+g_storage.get("http_port"):(a="https://"+a,g_storage.get("https_port")!="443"&&(a+=":"+g_storage.get("https_port")));var j=new davlib.DavClient;j.initialize();j.GSLL("/",function(b,c,e){if(b==200){b=parseXml(e);$("#tab2").empty();var d="<table id='sharelink' width='100%' border='0' style='table-layout:fixed'>";
d+="<thead><tr>";d+="<th scope='col' class='check' style='width:5%'>";d+="<input type='checkbox' id='select_all' name='select_all' class='select_all'>";d+="</th>";d+="<th scope='col' class='filename' style='width:20%'>"+m.getString("table_filename")+"</th>";d+="<th scope='col' class='createtime' style='width:25%'>"+m.getString("table_createtime")+"</th>";d+="<th scope='col' class='expiretime' style='width:25%'>"+m.getString("table_expiretime")+"</th>";d+="<th scope='col' class='lefttime' style='width:15%'>"+
m.getString("table_lefttime")+"</th>";d+="<th scope='col' class='remove' style='width:10%'>"+m.getString("func_delete")+"</th>";d+="</tr></thead>";d+="<tbody id='ntb'>";var k=parseInt($(b).find("encode_filename").text()),h=0;$(b).find("sharelink").each(function(){try{var b="",c="";k==1?(b=$(this).attr("filename"),c=decodeURIComponent(b)):(c=$(this).attr("filename"),b=encodeURIComponent($(this).attr("filename")));var e=a+"/"+$(this).attr("url")+"/"+b,g=$(this).attr("createtime"),f=$(this).attr("expiretime"),
j=parseFloat($(this).attr("lefttime")),n=parseInt(j/3600),q=parseInt(j%3600/60);d+="<tr nid='"+h+"' class='even'>";d+="<td fid='check' align='center'><input type='checkbox' id='check_del' name='check_del' class='check_del' link=\""+$(this).attr("url")+'"></td>';d+="<td fid='filename' align='center'><div style='overflow:hidden;'>";d+="<a class='share_link_url' uhref=\""+e+"\" href='#' title=\""+c+"\" style='white-space:nowrap;'>"+c+"</a>";d+="</div></td>";d+="<td fid='createtime' align='center'>"+
g+"</td>";f==0?(d+="<td fid='expiretime' align='center'>"+m.getString("title_unlimited")+"</td>",d+="<td fid='lefttime' align='center'>"+m.getString("title_unlimited")+"</td>"):(d+="<td fid='expiretime' align='center'>"+f+"</td>",d+="<td fid='lefttime' align='center'>"+n+" hours "+q+" mins</td>");d+="<td fid='remove' align='center'><a>";d+="<div class='dellink' title='remove' link=\""+$(this).attr("url")+"\" style='cursor:pointer'></div>";d+="</a></td>";d+="</tr>"}catch(r){}h++});d+="</tbody>";d+=
"</table>";d+="<div class='delcheck_block'>";d+="<span>\u522a\u9664\u9078\u53d6\u9023\u7d50</span>";d+="</div>";$(d).appendTo($("#tab2"));$("div.delcheck_block").css("visibility","hidden");$("a.share_link_url").click(function(){$("#filelink").css("display","block");$("#filelink").css("left",tempX);tempY+$("#filelink").height()>$("body").height()?$("#filelink").css("top",$("body").height()-$("#filelink").height()):$("#filelink").css("top",tempY);$("#resourcefile").attr("value",$(this).attr("uhref"));
$("#resourcefile").focus();$("#resourcefile").select()});$(".dellink").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&j.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})});$(".check_del").change(function(){var a=0;$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&a++});if(a<=0){var b=tempY+10,c=0;$("div.delcheck_block").animate({top:b,left:c},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})}else $("div.delcheck_block").css("visibility",
""),b=tempY+10,c=tempX+10,$("div.delcheck_block").animate({top:b,left:c},"fast")});$(".delcheck_block").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&($("div.delcheck_block").css("visibility","hidden"),$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&j.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})}))});$("input.select_all").change(function(){if($(this).prop("checked")){$("input:checkbox.check_del").prop("checked",
!0);$("div.delcheck_block").css("visibility","");var a=tempY+10,b=tempX+10;$("div.delcheck_block").animate({top:a,left:b},"fast")}else $("input:checkbox.check_del").prop("checked",!1),a=tempY+10,b=0,$("div.delcheck_block").animate({top:a,left:b},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})})}})}
function refreshCertificateInfo(){(g_storage.get("userpermission")==void 0?"":g_storage.get("userpermission"))=="admin"?$("#field_import_crt").show():$("#field_import_crt").hide();var e=new davlib.DavClient;e.initialize();e.GETX509CERTINFO("/",function(c,b,a){c==200&&(a=parseXml(a),c=$(a).find("issuer").text(),b=$(a).find("subject").text(),$(a).find("crt_start_date").text(),a=$(a).find("crt_end_date").text(),b!=""&&(b=b.substring(b.indexOf("CN=")+3,b.length),b.indexOf("/")!=-1&&(b=b.substring(0,b.indexOf("/")))),
c!=""&&(c=c.substring(c.indexOf("CN=")+3,c.length),c.indexOf("/")!=-1&&(c=c.substring(0,c.indexOf("/")))),a!=""&&(a=new Date(2E3+parseInt(a.substring(0,2)),parseInt(a.substring(2,4)),parseInt(a.substring(4,6))),a=a.getFullYear()+"-"+a.getMonth()+"-"+a.getDate()),c==b?$("#label_self_crt_type").text(m.getString("title_self_crt_type")):$("#label_self_crt_type").text(m.getString("title_third_crt_type")),$("#label_https_crt_cn").text(b),$("#label_https_crt_issuer").text(c),$("#label_https_crt_end_date").text(a),
c==""?$("#btn_export_crt").attr("disabled",!0):$("#btn_export_crt").attr("disabled",!1));e=null})}function doOK(){parent.closeJqmWindow()}function doCancel(){parent.closeJqmWindow()}function onCloseShareLink(){$("#filelink").css("display","none")}function onCloseImportCrt(){$("#import_crt").hide()}
function read_file(e,c){if(e!=null){var b=e.size-1,a=0,j=new FileReader;j.onloadend=function(b){b.target.readyState==FileReader.DONE&&c&&c(b,a)};e.webkitSlice?(b=e.webkitSlice(0,b+1),j.readAsText(b),a=1):e.mozSlice?(b=e.mozSlice(0,b+1),j.readAsBinaryString(b),a=0):(b=e.slice(0,b+1),j.readAsText(b),a=1)}}
function onDoImportCrt(){if(g_key_file==null)alert("Please select a key file.");else if(g_crt_file==null)alert("Please select a crt file.");else{var e="",c="",b="",a=function(){if(!(g_key_file!=null&&e=="")&&!(g_crt_file!=null&&c=="")&&!(g_intermediate_crt_file!=null&&b=="")){var a=new davlib.DavClient;a.initialize();a.SETROOTCERTIFICATE("/",e,c,b,function(b){b=="200"?($("#import_crt").hide(),alert(m.getString("msg_import_crt_complete")),a.APPLYAPP("/","apply","","restart_webdav",function(b){b==200&&
setTimeout(function(){parent.location.reload(!1)},6E3);a=null})):alert("Fail to import certificate file! Maybe the imported file is invalid, please check and try again.")},null)}};read_file(g_key_file,function(b){e=b.target.result;a()});read_file(g_crt_file,function(b){c=b.target.result;a()});read_file(g_intermediate_crt_file,function(c){b=c.target.result;a()})}}var IE=document.all?!0:!1;IE||document.captureEvents(Event.MOUSEMOVE);document.onmousemove=getMouseXY;var tempX=0,tempY=0;
function getMouseXY(e){IE?(tempX=event.clientX+document.body.scrollLeft,tempY=event.clientY+document.body.scrollTop):(tempX=e.pageX,tempY=e.pageY);tempX<0&&(tempX=0);tempY<0&&(tempY=0);return!0};
