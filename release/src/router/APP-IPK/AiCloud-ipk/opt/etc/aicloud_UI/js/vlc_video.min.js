var m=new lang,g_storage=new myStorage,g_this_video="",g_this_video_name="",g_this_video_hash="",g_play_id=-1,g_subtitle_timer=0,prevState=0,liveFeedText=["Playing","((Playing))","(( Playing ))","((  Playing  ))"],liveFeedRoll=0,g_isIE=!1,g_video_status="";
function detectVLCInstalled(){navigator.userAgent.toLowerCase();var a=!1;if(g_isIE){var c=null;try{c=new ActiveXObject("VideoLAN.Vlcplugin")}catch(b){var d="An exception occurred while trying to create the object VideoLAN.VLCPlugin.1:\n";for(p in b)d+="e."+p+"= "+b[p]+"\n"}null!=c&&(a=!0)}else if(navigator.plugins&&navigator.plugins.length)for(c=0;c<navigator.plugins.length;c++)if(d=navigator.plugins[c],d.name.indexOf("VideoLAN")>-1||d.name.indexOf("VLC")>-1)a=!0;return a}
function getInternetExplorerVersion(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}function closeWindow(){parent.closeJqmWindow(0)}$(document).keydown(function(a){if(a.keyCode==27)return!1});function init(){setTimeout(function(){createVLC()},500)}function getVLC(a){return document.getElementById(a)}
function monitor(){var a=getVLC("vlc"),c=0;if(a)c=a.input.state;prevState!=c?(c==0?onEnd():c==1?onOpen():c==2?onBuffer():c==3?onPlaying():c==4?onPause():c==5?onStop():c==6?onEnd():c==7&&onError(),prevState=c):c==3&&onPlaying()}function formatTime(a){if(typeof a!="number")return"-:--:--";var a=Math.round(a/1E3),c=a%60;c<10&&(c="0"+c);var a=(a-c)/60,b=a%60;b<10&&(b="0"+b);a=(a-b)/60;return a>0?a+":"+b+":"+c:b+":"+c}
function doPlay(){var a=getVLC("vlc");a&&g_play_id>=0&&(g_video_status=="pause"?a.playlist.play():a.playlist.playItem(g_play_id),$(".play").css("display","none"),$(".pause").css("display","block"))}function doPause(){var a=getVLC("vlc");a&&(g_isIE?a.playlist.stop():a.playlist.pause(),$(".play").css("display","block"),$(".pause").css("display","none"))}function doStop(){var a=getVLC("vlc");a&&(a.playlist.stop(),$(".play").css("display","block"),$(".pause").css("display","none"),onStop())}
function onOpen(){g_video_status="open";document.getElementById("info").innerHTML="Opening..."}function onEnd(){g_video_status="stop";document.getElementById("info").innerHTML="End..."}function onBuffer(){document.getElementById("info").innerHTML="Buffering..."}function onPause(){g_video_status="pause";document.getElementById("info").innerHTML="Paused..."}function onStop(){g_video_status="stop";document.getElementById("info").innerHTML="-:--:--/-:--:--"}
function onError(){g_video_status="error";document.getElementById("info").innerHTML="Error..."}function record_playtime(){var a=getVLC("vlc");a&&g_storage.setl(g_this_video_hash,a.input.time)}
function onPlaying(){var a=getVLC("vlc"),c=document.getElementById("info");if(a){var b=a.input.length;b>0?($(".currTime").text(formatTime(a.input.time)),$(".totalTime").text(formatTime(b)),c.innerHTML=formatTime(a.input.time)+"/"+formatTime(b),a=a.input.time/b*$(".playbar .slider-tracker").width(),$(".playbar .slider-thumb").css("left",a),$(".playbar .slider-progress").css("width",a)):(liveFeedRoll&=3,c.innerHTML=liveFeedText[liveFeedRoll++])}record_playtime()}
function doMarqueeOption(a,c){var b=getVLC("vlc");val=parseInt(c);if(b){if(a==1)b.video.marquee.color=val;if(a==2)b.video.marquee.opacity=val;if(a==3)b.video.marquee.position=c;if(a==4)b.video.marquee.refresh=val;if(a==5)b.video.marquee.size=val;if(a==6)b.video.marquee.text=c;if(a==7)b.video.marquee.timeout=val;if(a==8)b.video.marquee.x=val;if(a==9)b.video.marquee.y=val}}function doAspectRatio(){var a=getVLC("vlc");if(a)a.video.aspectRatio=$("#select_aspect").val()}
function play_subtitle(){$(".srt").each(function(){var a=getVLC("vlc"),c=function(a){var b=0;if(a){a=a.split(":");for(i=0;i<a.length;i++)b=b*60+parseFloat(String(a[i]==null?"":a[i]).replace(",","."))}return b},b=function(a){return String(a==null?"":a).replace(/^\s+|\s+$/g,"")},d=function(a){var b=[],c;for(c in a)b.push(c);b.sort();c=[];for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]];return c},g=function(a){var e=a.text();a.text("");var e=e.replace(/\r\n|\r|\n/g,"\n"),f={},e=String(b(e)),g=1,e=e.split("\n\n");
for(s in e)if(st=String(e[s]).split("\n"),st.length>=2){n=st[0];i=b(st[1].split(" --\> ")[0]);o=b(st[1].split(" --\> ")[1]);t=st[2];if(st.length>2)for(j=3;j<st.length;j++)t+="\n"+st[j];is=c(i);os=c(o);f[g]={is:is,i:i,o:o,t:t};g++}var f=d(f),q=getVLC("vlc");if(q){var r=-1;g_subtitle_timer=setInterval(function(){var b=parseFloat(q.input.time/1E3),c=-1,d;for(d in f){if(f[d].is>b)break;c=d}c>0?c!=r?(a.text(f[c].t),r=c):f[c].o<b&&a.text(""):a.text("")},100)}},h=$(this);clearInterval(g_subtitle_timer);
a&&((a=h.attr("data-srt"))?$(this).load(a,function(){g(h)}):h.text(""))})}
function createVLC(){var a=getUrlVars(),c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan");m.setLanguage(c);var b=a.showbutton,c=a.v,d=a.u;g_this_video=c;g_this_video_name=c.substring(c.lastIndexOf("/")+1,c.lastIndexOf("."));g_this_video_hash=md5(g_this_video.substr(g_this_video.lastIndexOf("/")+1,g_this_video.length));navigator.userAgent.toLowerCase();var g=navigator.appVersion.toLowerCase();g_isIE=isIE();if(g.indexOf("mac")!=
-1)document.write("<video width='320' height='240' controls='controls'>"),document.write("<source src='"),document.write(c),document.write("' type='video/x-pn-realvideo'/>"),document.write("<source src='"),document.write(c),document.write("' type='video/ogg'/>"),document.write("Your browser does not support the video tag."),document.write("</video>");else if(detectVLCInstalled()){var g="655px",h="470px";b==1&&(g="655px",h="450px");b="";b+="<div>";g_isIE?(b+="<OBJECT classid='clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921'",
b+=" codebase='http://download.videolan.org/pub/videolan/vlc/last/win32/axvlc.cab'",b+=" id='vlc' name='vlc' width='"+g+"' height='"+h+"' events='True'>",b+="<param name='MRL' value='' />",b+="<param name='ShowDisplay' value='False'/>",b+="<param name='AutoLoop' value='False'/>",b+="<param name='AutoPlay' value='False'/>",b+="<param name='ToolBar' value='False'/>",b+="<param name='Volume' value='50' />",b+="<param name='StartTime' value='0' />",b+="</OBJECT>"):(b+="<embed type='application/x-vlc-plugin'",
b+=" pluginspage='http://www.videolan.org'",b+=" width='"+g+"' height='"+h+"' id='vlc' name='vlc' version='VideoLAN.VLCPlugin.2' text='Waiting for video' Volume='50' toolbar='False' AutoPlay='False'/>");b+="</div>";$(b).appendTo($(".videoplayer"));if(b=getVLC("vlc")){a=a.s==void 0?"":a.s;if(a!=""){for(var a=a.split(";"),k=!1,e="<option value=''>"+m.getString("title_no_subtitle")+"</option>",d=0;d<a.length;d++){var f=a[d];if(f!=""){var f=f.substr(f.lastIndexOf("/")+1,f.length),l=window.location.protocol+
"//"+window.location.host+a[d];e+="<option value='"+l+"'";f.indexOf(g_this_video_name)==0&&(e+="selected ",$(".subtitle").attr("data-srt",l));e+=">"+f+"</option>";k=!0}}$(e).appendTo($("#select_subtitle"));$(".subtitle-ctrl").css("display",k?"block":"none");play_subtitle()}else k=!1,e="<option value=''>"+m.getString("title_no_subtitle")+"</option>",a=new davlib.DavClient,a.initialize(),a.GETVIDEOSUBTITLE(d,g_this_video_name,function(a,b,c){a==200&&(a=parseXml(c),$(a).find("file").each(function(){var a=
$(this).find("name").text(),b=window.location.protocol+"//"+window.location.host+"/"+$(this).find("sharelink").text();e+="<option value='"+b+"'";a.indexOf(g_this_video_name)==0&&(e+="selected ",$(".subtitle").attr("data-srt",b));e+=">"+a+"</option>";k=!0}),$(e).appendTo($("#select_subtitle")),$(".subtitle-ctrl").css("display",k?"block":"none"),play_subtitle())}),a=null;g_play_id=b.playlist.add(c);if(g_play_id==-1)alert("cannot play at the moment !");else{if(g_isIE)b.style.width=g,b.style.height=h;
setInterval("monitor()",1E3);doPlay();$(".toolbar").css("display","block");c=parseInt($(".volumebar .slider-progress").css("left"));$(".volumebar .slider-thumb").css("left",37);$(".volumebar .slider-progress").css("width",37-c);c=g_storage.getl(g_this_video_hash);if(c!=void 0&&confirm(m.getString("msg_last_playtime")))b.input.time=parseInt(c)}}$("#label_subtitle").text(m.getString("title_subtitle_file")+": ");$("button#btnClose").text(m.getString("btn_close"));$(".footer").css("display","block");
$(".play").click(function(){doPlay()});$(".pause").click(function(){doPause()});$(".stop").click(function(){doStop()});$(".playbar .slider-thumb").draggable({axis:"x",snap:"true",cursor:"move",start:function(){},drag:function(a,b){var c=$(".playbar .slider-tracker").width();if(b.position.left<=0)b.position.left=0;if(b.position.left>=c)b.position.left=c;$(".playbar .slider-progress").css("width",b.position.left)},stop:function(a,b){var c=0,d=getVLC("vlc");if(d&&(c=d.input.length,c>0))c*=b.position.left/
$(".playbar .slider-tracker").width(),d.input.time=c,d.playlist.play()}});$(".volumebar .slider-thumb").draggable({axis:"x",snap:"true",cursor:"move",drag:function(a,b){var c=parseInt($(".volumebar .slider-progress").css("left")),d=74-$(".volumebar .slider-thumb").width()+c;if(b.position.left<=c)b.position.left=c;if(b.position.left>=d)b.position.left=d;$(".volumebar .slider-progress").css("width",b.position.left-c);if(c=getVLC("vlc"))c.audio.volume=b.position.left/74*200},stop:function(a,b){var c=
getVLC("vlc");if(c)c.audio.volume=b.position.left/74*200}});$("#select_subtitle").change(function(){$(".subtitle").attr("data-srt",$(this).attr("value"));play_subtitle()})}else document.write("<body width='100%' height='100%' style='margin:0px;padding:0px'>"),b==1?document.write("<div id='errorpage' style='overflow:none;background-image:url(vlc_bg_img.jpg);background-repeat:no-repeat;width:100%; height:94%'>"):document.write("<div id='errorpage' style='background-image:url(vlc_bg_img.jpg);background-repeat:no-repeat;width:100%; height:100%'>"),
document.write("<p style='position:relative;left:54px;top:60px;width:500px;font-size:20px;color:#ffffff'>"+m.getString("msg_installvlc")+"</p>"),document.write("<p style='position:relative;left:54px;top:80px;width:550px;font-size:16px;color:#ffffff;text-align:left'>"+m.getString("msg_installvlc2")+"</p>"),document.write("<p style='position:relative;left:216px;top:100px;width:350px;font-size:14px;color:#ffffff;text-align:left'>"+m.getString("msg_installvlc3")+"</p>"),document.write("<a href='http://www.videolan.org/vlc/' target='_blank'><div style='width:123px;height:30px;background-image:url(downloadvlc.png);position:relative;left:456px;top:100px;cursor:pointer'></div></a>"),
document.write("</div></body>"),b==1&&document.write("<div width='100%'><button id='btnClose' style='position: relative;float:right;right:5px;' onclick='parent.closeJqmWindow(0);'>close</button><div>"),document.write("</body>"),window.resizeTo(640,460)};
