#!/bin/sh

DEVICE=$1

ifconfig $DEVICE 0.0.0.0 2>/dev/null || {
    echo "$0 <subscriber-lan-device>"
    echo "create a vlan interface with:"
    echo "  vconfig add <interface> <vlan-id>"
    exit
}

[ -d  @ETCCHILLI@/$DEVICE ] || mkdir @ETCCHILLI@/$DEVICE

cat > @ETCCHILLI@/$DEVICE/chilli.conf <<EOF
# Generated by $0
include @ETCCHILLI@/$DEVICE/main.conf
include @ETCCHILLI@/$DEVICE/hs.conf
include @ETCCHILLI@/$DEVICE/local.conf

ipup=@ETCCHILLI@/up.sh
ipdown=@ETCCHILLI@/down.sh
EOF

cat @ETCCHILLI@/config | \
    grep -v HS_LANIF > @ETCCHILLI@/$DEVICE/config