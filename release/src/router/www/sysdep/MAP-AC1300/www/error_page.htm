<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html xmlns:v>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<meta charset="utf-8" />
<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Expires" CONTENT="-1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="icon" href="images/favicon.png">
<title><#Web_Title#> - <#errormessage_title#></title>
<script type="text/JavaScript" src="/js/jquery.js"></script>
<style>
body{
	color: #181818;
	font-family: Arial;
}
.wrapper{
	background-size: 1330px 580px;
}
.title_name {
    font-family: Arial;
    font-weight: bold;
    font-size: 29px;
    color: #181818;
    text-align: center;
}
.title_text{
	width:580px;
	padding-top: 13px;
	margin:auto;
	font-family: Arial;
    font-weight: bold;
    font-size: 18px;
    color: #181818;
    text-align: center;
}
.prod_madelName{
    padding-top: 12px;
    text-align: center;
    font-family: Arial;
    font-weight: bold;
    font-size: 15px;
    color: #181818;
}
.div_img {
	text-align:center;
	padding-top: 20px;
}

.blocking_img{
	width:372px;
	height:303px;
	background-position:center;
	background-attachment:fixed;
	background:url(images/New_ui/asus_hive_block_internet_web.png) no-repeat center;
	margin:auto;
}
.p1{
	font-family: Arial;
    font-weight: bold;
    font-size: 17px;
    color: #181818;
	width: 480px;
}
ul {
	margin-left: -21px;
	color: #28d1a5;
}

li span {
	font-family: Arial;
	font-weight:bold;
	font-size: 15px;
	color: #181818;
}

#failReason1{
	font-family: Arial;
	font-weight:bold;
	font-size: 15px;
	color: #181818;
}

.button{
	display: inline-block;
	width: 300px;
	border: 2px solid #27D1A4;
	border-radius: 35px;
	height: 66px;
	line-height: 66px;
	margin: 30px 20px;
	font-size:1.5em;
	cursor:pointer;
	color: #FFF;
	background: #27D1A4;
	text-align: center;
}
.form_input{
	background-color:rgba(255,255,255,0.2);
	background-color:#576D73\9;
	border-radius: 4px;
	padding:26px 22px;
	width: 480px;
	border: 0;
	height:25px;
	color: #181818;
	color:#000\9; /* IE6 IE7 IE8 */
	font-size:28px
}
.nologin{
	margin:10px 0px 0px 78px;
	background-color:rgba(255,255,255,0.2);
	background-color:#576D73\9;
	padding:10px 0px;
	line-height:36px;
	border-radius: 5px;
	width: 480px;
	border: 0;
	color: #181818;
	font-size:28px;
}
.div_table{
	display:table;
}
.div_tr{
	display:table-row;
}
.div_td{
	display:table-cell;
}
.title_gap{
	margin:10px 0px 0px 78px;
}
.img_gap{
	padding-right:30px;
	vertical-align:middle;
}
.password_gap{
	margin:30px 0px 0px 78px;
}
.error_hint{
	color: rgb(255, 204, 0);
	margin:10px 0px -10px 78px;
	font-size: 18px;
	font-weight: bolder;
}
.main_field_gap{
	margin: 100px auto 0;
}
ul{
	margin: 0;
}
#wanLink{
	cursor: pointer;
}
.button_background{
	background-color: transparent;
}

.connect{
	-webkit-animation: connecting 3s infinite linear;
	-moz-animation: connecting 3s infinite linear;
	-o-animation: connecting 3s infinite linear;
	animation: connecting 3s infinite linear;
}
.block_info_div{
	width: 60%;
	margin: 0px 200px auto auto;
}

.hive_app{
	text-align: center;
	font-size: 18px;
	margin: 10px 0px 0px -97px;
	font-family: Arial, Helvetica, sans-serif;
	width:600px;
}

/*for mobile device*/
@media screen and (max-width: 1000px){
	.title_name {
		font-size: 1.2em;
		color:#181818;
		margin-left:15px;
	}
	.prod_madelName{
		font-size: 1.2em;
		margin-left: 15px;
	}
	.p1{
		font-size: 12pt;
		width:100%;
	}
	.login_img{
		background-size: 75%;
	}
	.title_text{
	}
	.div_img {
		padding-top: 3px;
	}

	.blocking_img{
		background-size: 75%;
	}
	.form_input{
		padding:13px 11px;
		width: 100%;
		height:25px;
		font-size:16px
	}
	.button{
		height: 50px;
		width: 50%;
		font-size: 14pt;
		line-height: 50px;
		margin: 35px 25% 0px 25%;
	}
	.nologin{
		margin-left:10px;
		padding:10px;
		line-height:18px;
		width: 100%;
		font-size:14px;
	}
	.error_hint{
		margin-left:10px;
	}
	.main_field_gap{
		width: 60%;
		margin-top: 30px;
	}
	.title_gap{
		margin-left:15px;
	}
	.password_gap{
		margin-left:15px;
	}
	.img_gap{
		padding-right:0;
		vertical-align:middle;
	}
	ul{
		margin-left:-20px;
	}
	li{
		margin: 10px 0;
	}

	.connect{
		-webkit-animation: connecting 3s infinite linear;
		-moz-animation: connecting 3s infinite linear;
		-o-animation: connecting 3s infinite linear;
		animation: connecting 3s infinite linear;
	}
	.block_info_div{
		width: 88%;
		margin: auto 0;
	}
	.hive_app{
		margin: 10px 0px 0px 0px;
		width: 100%;
	}
}

@keyframes connecting {
	0% {
		left: 30px;
	}
	50% {
		left: 220px;
	}
		100% {
	left: 30px;
}
</style>
<script type="text/javascript">
// get the wan state at the first time.
var casenum = '<% get_parameter("flag"); %>';
var sw_mode = '<% nvram_get("sw_mode"); %>';
var wlc_psta = '<% nvram_get("wlc_psta"); %>';
var wlc_express = '<% nvram_get("wlc_express"); %>';
if( ((sw_mode == 2 || sw_mode == 3) && wlc_psta == 1) || (sw_mode == 3 && wlc_psta == 3))
	sw_mode = 4;

if(sw_mode == 3 && wlc_psta == 2)
	sw_mode = 2;

var wanstate = -1;
var wansbstate = -1;
var wanauxstate = -1;
<% wanstate(); %>
//2014.05 Viz add for T-MOBILE
var isSupport = function(_ptn){return ('<% nvram_get("rc_support"); %>'.search(_ptn) == -1) ? false : true;}
var tmo_support = isSupport("tmo");
var dsl_support = isSupport("dsl");

//Dual WAN unit
var wans_dualwan_orig = '<% nvram_get("wans_dualwan"); %>';
var wans_flag = (wans_dualwan_orig.search("none") == -1) ? 1 : 0;
if(wans_dualwan_orig.search(" ") == -1)
	wans_flag = 0;

var new_lan_ip = [<% get_next_lanip(); %>][0].next_lanip;
var header_info = [<% get_header_info(); %>];
var location_org = header_info[0].protocol + "://" + header_info[0].host + ":" + header_info[0].port;

function initial(){
	<% login_state_hook(); %>
	var LoginIP = login_ip_str();
	var nowIP = login_ip_str_now();
	var html_code = '';
	var url_flag = "";
	var html_code_notlogin = "<ul><li><span><#web_redirect_suggestion_admin#></span></li></ul>";
	var showtext = function(obj, str){if(obj)obj.innerHTML=str;}

	if(casenum == 1){
		$("#page_title").html("<#web_redirect_reason1#>");
		//showtext($("#failReason1")[0], "<#web_redirect_reason1#>");
		html_code += "<ul>";
		html_code += "<li><span><#web_redirect_case1_suggestion1#></span></li>";
		html_code += "<li><span>Please check if you need to change the Operation Mode</span></li>";
		html_code += "</ul>";
		$("#wanLink").click(function(){
			detect_general();
		});

		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum == 2){
		html_code += "<ul>";
		html_code += "<li><span>";

		if(wansbstate == 2 || wanauxstate == 3){	//Authentication Failed
			$("#page_title").html("<#web_redirect_case2_title1#>");
			//showtext($("#failReason1")[0], "<#web_redirect_reason2_1#>");
			html_code += "<div>Your PPPoE account or password is not accepted, please check</div>";
			$("#wanLink").click(function(){
				//pppoeLink();
			});
		}
		else if(wansbstate == 1){		//No Response

		}
		else if(wansbstate == 10){		//Terminal due to lack of activity

		}
		else{	//Connecting
			//showtext($("#failReason1")[0], "<#web_redirect_reason2_2#>");
			//html_code += "<div>";
			//html_code += "<span><#web_redirect_suggestion2_2#></span>";
			//html_code += "<span><#web_redirect_suggestion2_2_desc#></span>";
			//html_code += "</div>";
			$("#animation_field").show();
			detect_ppp_connect();
			$("#page_title").html("<#web_redirect_reconnecting#>");
			$("#reason_title").hide();
			$("#reason_field").hide();
			$("#suggest_title").hide();
			$("#suggestion").hide();
			$("#case_content").hide();
			$("#back_btn").show();
			$("#wanLink").click(function(){
				//detectLink();
				history.go(-1);
			});
			$("#wanLink").html("<#prev_page#>");
		}

		html_code += "</span></li>";
		html_code += "</ul>";
		$("#wanLink").hide();
		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum == 3){
		$("#page_title").html("<#qis_fail_desc7#>");
		//showtext($("#failReason1")[0], "<#qis_fail_desc5#>");
		html_code += "<ul>";
		html_code += "<li><span>Please check the connection settings is correct.</span></li>";
		html_code += "<li><span><#web_redirect_suggestion3#></span></li>";
		html_code += "</ul>";
		$("#wanLink").click(function(){
			detect_general();
		});
		$("#wanLink").html("<#web_redirect_case3_button#>");

		$("#wanLink").hide();
		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum == 4){
		showtext($("#failReason1")[0], "<#web_redirect_reason4#>");
		html_code += "<ul>";
		html_code += "<li><span><#web_redirect_suggestion4#></span></li>";
		html_code += "</ul>";
		$("#wanLink").click(function(){
			detect_general();
		});
	}
	else if(casenum == 5){
		if(wanstate == 5){
			$("#page_title").html("<#web_redirect_case5_title1#>");

		}
		else{
			$("#page_title").html("<#web_redirect_case5_title2#>");
		}

		html_code += '<ul>';
		if(wanstate == 5){
			html_code += "<li><span>We suggest you turn on the WAN connection button</span></li>";
		}
		else{
			html_code += "<li><span><#web_redirect_case5_suggestion2#></span></li>";
			html_code += "<li><span>Change USB modem setting</span></li>";
		}

		html_code += '</ul>';
		if(wanstate == 5){
			$("#wanLink").click(function(){
				manually_start_wan_Link();
			});
		}else{
			$("#wanLink").click(function(){
				detect_general();
			});
		}

		$("#wanLink").hide();
		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum.search("6") !== -1){
		$("#page_title").html("<#web_redirect_reason6#>");
			html_code += "<ul>";
			html_code += "<li><span><#web_redirect_case6_desc1#>";
			html_code += "<span style='font-weight:bolder'>"+ new_lan_ip +"</span></span></li>";
			html_code += "<li><span><#web_redirect_case6_desc2#></span></li>";
			html_code += "</ul>";

		$("#wanLink").html("<#CTL_next#>").show();
		$("#wanLink").click(function(){
			change_lan_subnet();
		});

		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum == 8){
		$("#page_title").html("<#web_redirect_case8_title#>");
		//showtext($("#failReason1")[0], "<#APSurvey_action_ConnectingStatus0#>");
		if(LoginIP != "0.0.0.0" && LoginIP != nowIP){
			html_code = html_code_notlogin;
			$("#wanLink").hide();
		}
		else{
			html_code += "<ul>";
			html_code += "<li><span><#web_redirect_case8_suggestion1#></span></li>";
			html_code += "<li><span>Change the connection setting</span></li>";
			//html_code += "<li><#web_redirect_suggestion0_1#></li>";
			html_code += "</ul>";

			if(sw_mode == "2"){
				if(wlc_express == '1')
					url_flag += "sitesurvey_exp2";
				else if(wlc_express == '2')
					url_flag += "sitesurvey_exp5";
				else
					url_flag += "sitesurvey_rep";
			}
			else
				url_flag += "sitesurvey_mb";

			$("#wanLink").click(function(){
				top.location.href = "/QIS_wizard.htm?flag=" + url_flag;
			});
		}

		$("#wanLink").hide();
		$("#reason_title").hide();
		$("#reason_field").hide();
		$("#suggestion").hide();
	}
	else if(casenum == 10){
		$("#oops").html("ASUS Lyra");
		$("#page_title").hide();
		$("#reason_title").hide();
		$("#suggest_title").hide();
		$("#suggestion").hide();
		html_code +='<div class="hive_app">';
		html_code +='<div>Please download the ';
		html_code +='<span style="font-size: 18px; color:#2791C6">Lyra app </span>';
		html_code +='to explore more fantastic features!</div>';
		html_code +='<div style="width: 285px; height: 46px; margin: 6px auto;">';
		html_code +='<div style="width: 140px; float: left;">';
		html_code +='<a href="https://play.google.com/store/apps/details?id=com.asus.hive" target="_blank">';
		html_code +='<div style="width:172px; height:51px;background:url(\'/images/googleplay.png\') no-repeat;background-size:75%;"></div>';
		html_code +='</a></div><div style="width: 140px;float: left;">';
		html_code +='<a href="https://itunes.apple.com/us/app/asus-lyra/id1171291475" target="_blank">';
		html_code +='<div style="width:172px; height:51px;background:url(\'/images/AppStore.png\') no-repeat;background-size:79%;"></div>';
		html_code +='</a></div></div></div>';
		$("#reason_field").hide();
	}
	else{
		parent.location = '/';
	}

	$("#case_content")[0].innerHTML  = html_code;
	if(casenum == "6_1"){
		change_lan_subnet();
	}

	var windowHeight = (function(){
		if(window.innerHeight)
			return window.innerHeight;
		else if(document.body && document.body.clientHeight)
			return document.body.clientHeight;
		else if(document.documentElement && document.documentElement.clientHeight)
			return document.documentElement.clientHeight;
		else
			return 800;
	})();

	document.getElementById("loginTable").style.display = "";
}

function pppoeLink(){
	top.location.href = "/QIS_wizard.htm?flag=pppoe";
}

function detectLink(){
	top.location.href = "/QIS_wizard.htm?flag=detect";
}

function manually_start_wan_Link(){
	top.location.href = '<% abs_index_page(); %>'+"?flag=Internet";
}

function change_lan_subnet(){
	document.form.force_change.value++;
	document.form.submit();
	setTimeout(detect_router, 5000);
	$("#wanLink").hide();
	$("#submitBtn").show();
}

function detect_router(){
	$.ajax({ 
		url: location_org.replace(header_info[0].host, new_lan_ip) + "/repage.json",
		dataType: "script",
		timeout: 5000,
		success: function(){
			top.location.href = location_org.replace(header_info[0].host, new_lan_ip) 
				+ "/QIS_wizard.htm?flag=" 
				+ (function(){return (('<% nvram_get("x_Setting"); %>' === '0')?"welcome":"detect")})();
		},
		error: function(){
			setTimeout(detect_router, 1000);
			setTimeout(function(){
				$("#case_content ul").html("<li><#error_page_lanip_changed_desc1#></li>");
			}, 3000);
		}
	});
}

function detect_general(){
	if(wans_flag){		//Dual WAN
		if(wans_dualwan_orig.split(" ")[0].toUpperCase == "USB"){
			top.location.href = '/Advanced_Modem_Content.asp';
		}else if(dsl_support){
			if(wans_dualwan_orig.split(" ")[0].toUpperCase == "WAN" || wans_dualwan_orig.split(" ")[0].toUpperCase == "LAN")
				top.location.href = '/Advanced_WAN_Content.asp';
			else
				top.location.href = '/Advanced_DSL_Content.asp';
		}
		else
			top.location.href = '/Advanced_WAN_Content.asp';
	}
	else{		//Single WAN
		if(dsl_support)
			top.location.href = '/Advanced_DSL_Content.asp';
		else if(sw_mode == 3)
			top.location.href = '/';
		else
			top.location.href = '/Advanced_WAN_Content.asp';
	}
}

function detect_ppp_connect(){
	$.ajax({
		url: '/WAN_info.asp',
		dataType: 'script',
		error: function(xhr){
			setTimeout(detect_ppp_connect, 1000);
		},
		success: function(response){
			if( wanstate == "2"  && wansbstate == "0" && wanauxstate == "0"){
				//history.go(-1);
				top.location.href = '/';
			}
			else{
				setTimeout(detect_ppp_connect, 1000);
			}
		}
	});
}
</script>

</head>
<body class="wrapper" onload="initial();">
	<iframe name="hidden_frame" id="hidden_frame" width="0" height="0" frameborder="0"></iframe>
	<form method="post" name="form" action="/start_apply.htm" target="hidden_frame">
		<input type="hidden" name="action_mode" value="apply">
		<input type="hidden" name="action_script" value="restart_subnet">
		<input type="hidden" name="action_wait" value="5">
		<input type="hidden" name="force_change" value='<% nvram_get("force_change"); %>'>
		<input type="hidden" name="flag" value="background">
	</form>

	<div id="loginTable" class="div_table main_field_gap" style="display:none">
		<div id="oops" class="div_tr title_name">Oops!</div>
		<div class="div_tr title_name">
			<div id="page_title" class="div_td title_text"><#web_redirect_message#></div>
		</div>
		<div class="prod_madelName"><#Web_Title2#></div>
		<div class="div_img">
			<div class="blocking_img"></div>
		</div>
		<div class="block_info_div">
		<div id="reason_title" class="p1 title_gap"><#web_redirect_fail_reason0#></div>
		<div id="reason_field">
			<div class="p1 title_gap"></div>
			<div class="nologin">
				<div id="failReason1"></div>
			</div>
		</div>

		<div id="suggest_title" class="p1 title_gap"><#web_redirect_suggestion0#> :</div>
		<div>
			<div class="p1 title_gap"></div>
			<div class="nologin">
				<div id="animation_field" style="display:none">
					<div style="display:table">
						<div style="display:table-row">
							<div style="display:table-cell">
								<div style="width:120px;height:100px;background:url('images/Model_product.png') no-repeat;background-size:100%;"></div>
							</div>
							<div style="display:table-cell;width:300px;vertical-align:middle;position:relative">
								<div style="width:200px;height:3px;background:#279FD9;margin-left:30px;"></div>
								<div class="connect" style="width:12px;height:12px;border-radius:100px;position:absolute;background:#181818;top:49px;left:30px;"></div>
							</div>
							<div style="display:table-cell">
								<div style="width:110px;height:110px;background:url('images/Internet.png')"></div>
							</div>
						</div>
					</div>
				</div>
				<div id="case_content"></div>
				<div id="suggestion">
					<ul>
						<li>
							<span><#web_redirect_suggestion_final#></span>
						</li>
					</ul>
				</div>
			</div>
		</div>
		</div>
		<div>
		<div style="text-align: center;">
		<div id="wanLink" class='button'><#btn_go#></div>
			<div id="submitBtn" class='button button_background' style="color:#27D1A4; display:none;">
				<span><#CTL_reconnection#>&nbsp</span><img src="/images/InternetScan.gif">
			</div>
		</div>
	</div>
</body>
</html>
